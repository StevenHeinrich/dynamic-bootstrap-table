/**
Dynamic Bootstrap Table - 0.1.4
https://github.com/eherman/dynamic-bootstrap-table
Copyright (c) 2014 Eric Herman
License: MIT
*/
!function(a){function b(a){var b=1;return"-"===a[0]&&(b=-1,a=a.substr(1)),function(c,d){var e=c.record[a]<d.record[a]?-1:c.record[a]>d.record[a]?1:0;return e*b}}a.fn.Datatable=function(b){return this.each(function(){var d=a(this),e=d.data("datatable");e||d.data("datatable",e=new c(this,b))}).data("datatable")};var c=function(b,c){this.$el=a(b),c&&a.extend(this,c),this.init()};c.prototype={recordIdCounter:1,sortable:!0,searchable:!0,searchBy:"",pagination:!0,paginatorSize:5,pageSizes:[5,10,20],currentPage:1,totalPages:1,closeable:!1,afterClose:void 0,clickable:!1,afterRowClick:void 0,addRowClasses:void 0,init:function(){var b=this;if(this.data=this.scrubData(this.data),this.masterData=this.data.slice(),this.$el.append(this.generateDatatableTemplate()),this.currentPageSize||(this.currentPageSize=this.pageSizes[0]),this.pagination){for(var c="",d=0;d<b.pageSizes.length;d++)c+='<option value="'+b.pageSizes[d]+'">'+b.pageSizes[d]+"</option>";a(".pageSizeSelector select").append(c),a(".pageSizeSelector select").val(b.currentPageSize),a(".pageSizeSelector select").change(function(){b.currentPageSize=parseInt(a(this).val(),10),b.updateResultsCount(),b.updateTable(),b.updatePaginator(),b.updatePageSelect()}),a(".pageSelector select").change(function(){b.currentPage=parseInt(a(this).val(),10),b.updateResultsCount(),b.updateTable(),b.updatePaginator()}),this.updateResultsCount(),this.updatePaginator(),this.updatePageSelect()}else this.currentPageSize=this.data.length;this.searchable&&(a(".searchField input").bind("keydown",function(c){13===c.keyCode&&(b.filter(a(".searchField input").val()),b.searchBy=a(".searchField input").val(),b.sortBy&&b.reverse&&b.sort(b.sortBy,b.reverse),b.currentPage=1,b.updateResultsCount(),b.updatePaginator(),b.updatePageSelect(),b.updateTable())}),a(".searchField button").on("click",function(){b.filter(a(".searchField input").val()),b.searchBy=a(".searchField input").val(),b.sortBy&&b.reverse&&b.sort(b.sortBy,b.reverse),b.currentPage=1,b.updateResultsCount(),b.updatePaginator(),b.updatePageSelect(),b.updateTable()})),this.closeable&&a(".datagridCloseBtn").on("click",function(){b.$el.hide(),b.afterClose()}),this.updateTable()},openTable:function(){this.$el.show()},addData:function(b){b=this.scrubData(b),a.merge(this.data,b),a.merge(this.masterData,b),this.filter(this.searchBy),this.sortBy&&this.sort(this.sortBy,this.reverse),this.updateResultsCount(),this.updatePaginator(),this.updatePageSelect(),this.updateTable()},removeAllData:function(){this.data=[],this.masterData=[],this.currentPage=1,this.updateResultsCount(),this.updatePaginator(),this.updatePageSelect(),this.updateTable()},updateColumns:function(a){this.columns=a,this.currentPage=1,this.updateResultsCount(),this.updatePaginator(),this.updatePageSelect(),this.updateTable()},scrubData:function(b){var c=this,d=[];return a.each(b,function(b,e){a.each(c.columns,function(a,b){(null===e[b]||void 0===e[b])&&(e[b]="")});var f={id:c.recordIdCounter.toString(),record:e};d.push(f),c.recordIdCounter++}),d},updateTable:function(){var b,c,d,e="",f=[],g=[],h=0,i=this;for(a(".headTable table thead tr").empty(),a(".bodyTable table").empty(),a.each(this.columns,function(a,b){e+=i.sortable&&b===i.sortBy?i.reverse?'<th class="cellDiv"><span>'+b+'</span><span class="ui-arrow">&#x25BC;</span></th>':'<th class="cellDiv"><span>'+b+'</span><span class="ui-arrow">&#x25B2;</span></th>':'<th class="cellDiv"><span>'+b+"</span></th>"}),a(".headTable table thead tr").append(e),this.sortable&&a(".headTable table thead th.cellDiv").addClass("sortableHeader"),a.each(this.data.slice(this.startFeature,this.endFeature),function(b,c){var d,e="";a.each(i.columns,function(a,b){e+='<td class="cellDiv"><span>'+c.record[b]+"</span></td>"}),"function"==typeof i.addRowClasses&&(d=i.addRowClasses(c).join(" ")),a(".bodyTable table").append(b%2!==0?'<tr class="rowDiv oddRow '+d+'" record-id="'+c.id+'">'+e+"</tr>":'<tr class="rowDiv evenRow '+d+'" record-id="'+c.id+'">'+e+"</tr>")}),this.clickable&&(a(".bodyTable table tr").addClass("clickableRow"),a(".bodyTable table tr").on("click",function(b){var c=a(this).attr("record-id"),d=i.getRecordById(c);i.afterRowClick(b,d)}),a(".bodyTable table tr").on("contextmenu",function(b){b.preventDefault();var c=a(this).attr("record-id"),d=i.getRecordById(c);i.afterRowClick(b,d)})),c=0;c<this.columns.length;c++)d=a(".headTable table").children().eq(0).children().eq(0).children().eq(c).outerWidth(),f[c]=d,g[c]?d>g[c]&&(g[c]=d):g[c]=d;for(b=0;b<this.currentPageSize;b++)for(c=0;c<this.columns.length;c++)d=a(".bodyTable table").children().eq(0).children().eq(b).children().eq(c).outerWidth(),g[c]?d>g[c]&&(g[c]=d):g[c]=d;for(c=0;c<this.columns.length;c++)a(".headTable table").children().eq(0).children().eq(0).children().eq(c).css("width",g[c]);for(b=0;b<this.currentPageSize;b++)for(c=0;c<this.columns.length;c++)a(".bodyTable table").children().eq(0).children().eq(b).children().eq(c).css("width",g[c]);for(b=0;b<g.length;b++)h+=g[b];a(".bodyTable").innerHeight(a(".tableContainer").innerHeight()-55),a(".outerTable").innerWidth(h+15),a(".headTable").innerWidth(h+15),a(".bodyTable").innerWidth(h+15),a(".bodyTable").width()<=a(".tableContainer").width()&&(a(".outerTable").css("width","100%"),a(".headTable").css("width","100%"),a(".bodyTable").css("width","100%"),a(".headTable table").css("width","100%"),a(".bodyTable table").css("width","100%"),a(".cellDiv").css("display","table-cell")),this.sortable&&a(".headTable .cellDiv").on("click",function(){var b=a(this).index();i.sortBy===i.columns[b]&&i.reverse===!1?(i.reverse=!0,i.sort(i.columns[b],!0)):(i.sortBy=i.columns[b],i.reverse=!1,i.sort(i.columns[b],!1)),i.currentPage=1,i.updateResultsCount(),i.updatePaginator(),i.updatePageSelect(),i.updateTable()})},updatePaginator:function(b){var c=this;if(this.pagination){var d={bootstrapMajorVersion:3,currentPage:b||c.currentPage,numberOfPages:c.paginatorSize,totalPages:c.totalPages,onPageClicked:function(a,b,d,e){c.currentPage=e,c.updateResultsCount(),c.updateTable(),c.updatePageSelect()}};a(".centerFooterDiv ul").bootstrapPaginator(d)}},updatePageSelect:function(){var b=this;if(this.pagination){var c="";a(".pageSelector select").empty();for(var d=1;d<=b.totalPages;d++)c+='<option value="'+d+'">'+d+"</option>";a(".pageSelector select").append(c),a(".pageSelector select").val(b.currentPage)}},updatePageSizeSelect:function(){this.pagination&&a(".pageSizeSelector select").val(this.currentPageSize)},updateResultsCount:function(){var b=this;this.pagination&&(0===b.data.length?(b.totalPages=1,b.currentPage=1):b.totalPages=b.data.length%b.currentPageSize===0?parseInt(b.data.length/b.currentPageSize,10):parseInt(b.data.length/b.currentPageSize,10)+1,b.currentPage>b.totalPages&&(b.currentPage=b.totalPages),b.startFeature=(b.currentPage-1)*b.currentPageSize,b.endFeature=b.currentPage===b.totalPages?b.data.length:parseInt(b.startFeature,10)+b.currentPageSize,a(".resultsCountDiv").empty(),a(".resultsCountDiv").append(0===b.data.length?"No items":b.startFeature+1+" - "+b.endFeature+" of "+b.data.length+" items"))},generateDatatableTemplate:function(){var a="",b='<button type="button" class="datagridCloseBtn close" data-dismiss="dialog" aria-hidden="true">&times;</button>',c='<div class="tableHeader"><div class="searchField input-group"><input type="text" class="form-control" data-placement="bottom" title="Search on field text"><span class="input-group-btn"><button class="btn btn-primary" type="button"><span class="glyphicon glyphicon-search"></span></button></span></div>';this.closeable&&(c+=b),c+="</div>";var d='<div class="tableContainer"><div class="outerTable"><div class="headTable"><table><thead><tr class="rowDiv"></tr></thead></table></div><div class="bodyTable"><table></table></div></div></div>',e='<div class="tableFooter"><div class="leftFooterDiv"><div class="pageSelector">Go to page:<select class="form-control"></select></div><div class="resultsCountDiv"></div></div><div class="centerFooterDiv"><ul></ul></div><div class="rightFooterDiv"><div class="pageSizeSelector">Page size:<select class="form-control"></select></div></div></div>';return this.searchable&&(a+=c),a+=d,this.pagination&&(a+=e),a},sort:function(a,c){this.sortable&&this.data.sort(c?b("-"+a):b(a))},filter:function(b){this.searchable&&(this.data=this.masterData.slice(),b&&(this.data=a.grep(this.data,function(a){var c,d;for(c in a.record)if("string"==typeof a.record[c]){if(d=new RegExp(b,"gi"),a.record[c].match(d))return!0}else if("number"==typeof a.record[c]&&(console.warn(a.record[c],"=",b),a.record[c].toString()===b))return!0;return!1})))},getRecordById:function(b){var c={};return a.each(this.masterData,function(a,d){return d.id.toString()===b.toString()?void(c=d.record):void 0}),c}}}(jQuery);